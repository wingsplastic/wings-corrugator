---
// src/pages/products.astro
import Layout from '../layouts/Layout.astro';

// 获取所有产品
const allProducts = await Astro.glob('../content/products/*.md');

// 定义所有分类（与 CMS 选项一致）
const categories = [
  "Extruders",
  "Extrusion Moulds",
  "SWC Pipe Corrugator",
  "DWC Pipe Corrugator",
  "Spiral Pipe Corrugator",
  "Pipe Winder Units",
  "Spiral Wrap Units"
];

// 为每个分类生成展示信息
const categoryInfo = categories.map(cat => {
  const slug = cat.toLowerCase().replace(/\s+/g, '-');
  const productsInCat = allProducts.filter(p => p.frontmatter.category === cat);
  const sampleImage = productsInCat.length > 0 ? productsInCat[0].frontmatter.image : null;
  return {
    name: cat,
    slug,
    count: productsInCat.length,
    image: sampleImage
  };
});
---

<Layout title="Products - Wings Corrugator">
  <h1>Our Products</h1>
  <p>Browse our product categories below.</p>
  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem;">
    {categoryInfo.map(cat => (
      <a href={`/products/category/${cat.slug}`} style="text-decoration: none; color: inherit;">
        <div style="border: 1px solid #e2e8f0; border-radius: 1rem; overflow: hidden; transition: box-shadow 0.3s;">
          {cat.image ? (
            <img src={cat.image} alt={cat.name} style="width: 100%; height: 200px; object-fit: cover;" />
          ) : (
            <div style="width: 100%; height: 200px; background-color: #e2e8f0; display: flex; align-items: center; justify-content: center; color: #64748b;">
              No image
            </div>
          )}
          <div style="padding: 1.5rem;">
            <h3 style="margin-bottom: 0.5rem;">{cat.name}</h3>
            <p style="color: #475569;">{cat.count} product{cat.count !== 1 ? 's' : ''}</p>
          </div>
        </div>
      </a>
    ))}
  </div>
</Layout>
