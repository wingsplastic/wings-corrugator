---
// src/pages/products/category/[category].astro
import Layout from '../../../layouts/Layout.astro';

export async function getStaticPaths() {
  // 定义所有类别（与 CMS 中的选项一致）
  const categories = [
    "Extruders",
    "Extrusion Moulds",
    "SWC Pipe Corrugator",
    "DWC Pipe Corrugator",
    "Spiral Pipe Corrugator",
    "Pipe Winder Units",
    "Spiral Wrap Units"
  ];

  // 为每个类别生成路径
  return categories.map(cat => ({
    params: { category: cat.toLowerCase().replace(/\s+/g, '-') }, // 将类别名转为 URL 友好的格式（如 "spiral-wrap-units"）
    props: { category: cat } // 传递原始类别名用于显示
  }));
}

const { category } = Astro.props;

// 获取所有产品
const allProducts = await Astro.glob('../../../content/products/*.md');
// 筛选属于当前类别的产品
const filteredProducts = allProducts.filter(p => p.frontmatter.category === category);
---

<Layout title={`${category} - Wings Corrugator`}>
  <h1>{category}</h1>
  {filteredProducts.length === 0 ? (
    <p>No products found in this category.</p>
  ) : (
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem;">
      {filteredProducts.map((product) => {
        // 生成产品详情页的 slug（与之前 products.astro 中的逻辑保持一致）
        const slug = product.frontmatter.slug || product.file.split('/').pop()?.replace('.md', '') || '';
        return (
          <a href={`/products/${slug}`} style="text-decoration: none; color: inherit;">
            <div style="border: 1px solid #e2e8f0; border-radius: 1rem; overflow: hidden; transition: box-shadow 0.3s;">
              {product.frontmatter.image && (
                <img src={product.frontmatter.image} alt={product.frontmatter.title} style="width: 100%; height: 200px; object-fit: cover;" />
              )}
              <div style="padding: 1.5rem;">
                <h3 style="margin-bottom: 0.5rem;">{product.frontmatter.title}</h3>
                <p style="color: #475569;">{product.frontmatter.description}</p>
              </div>
            </div>
          </a>
        );
      })}
    </div>
  )}
</Layout>
