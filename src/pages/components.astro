---
// src/pages/components.astro
import Layout from '../layouts/Layout.astro';

const subCategories = [
  { name: 'Corrugators', slug: 'corrugators' },
  { name: 'Extruders', slug: 'extruders' },
  { name: 'Die Heads', slug: 'die-heads' },
  { name: 'Mould Blocks', slug: 'mould-blocks' },
  { name: 'Coilers & Winders', slug: 'coilers-winders' }
];

const allProducts = await Astro.glob('../content/products/*.md');

const categoriesWithInfo = subCategories.map(cat => {
  const productsInCat = allProducts.filter(p => p.frontmatter.category === cat.name);
  const sampleImage = productsInCat.length > 0 ? productsInCat[0].frontmatter.image : null;
  return {
    name: cat.name,
    slug: cat.slug,
    count: productsInCat.length,
    image: sampleImage
  };
});
---

<Layout title="Components - Wings Corrugator">
  <h1>Components</h1>
  <p>High-quality components for pipe production lines.</p>
  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem;">
    {categoriesWithInfo.map(cat => (
      <a href={`/products/category/${cat.slug}`} style="text-decoration: none; color: inherit;">
        <div style="border: 1px solid #e2e8f0; border-radius: 1rem; overflow: hidden;">
          {cat.image ? (
            <img src={cat.image} alt={cat.name} style="width: 100%; height: 200px; object-fit: cover;" />
          ) : (
            <div style="width: 100%; height: 200px; background-color: #e2e8f0; display: flex; align-items: center; justify-content: center;">No image</div>
          )}
          <div style="padding: 1.5rem;">
            <h3>{cat.name}</h3>
            <p>{cat.count} products</p>
          </div>
        </div>
      </a>
    ))}
  </div>
</Layout>